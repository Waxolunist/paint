define(["exports","./my-app.js","../actions/painting.js"],function(_exports,_myApp,_painting2){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.waitForId=waitForId;_exports.waitTillTrue=waitTillTrue;_exports.htmlcolors_hsl=_exports.htmlcolors=_exports.$promises=_exports.$elements=_exports.$htmlcolors=void 0;var _templateObject_d4a2d29070a711e8ad63dbb32815d43a=babelHelpers.taggedTemplateLiteral(["\n      ","\n      ","\n      <style>\n        :host {\n          display: block;\n          width: 100%;\n          min-height: 100%;\n        }\n\n        .icon {\n          padding: 5px;\n        }\n\n        .icon.animated {\n          transform: scale(1);\n          will-change: transform;\n          transition-property: transform;\n        }\n        \n        .icon.animated:hover {\n          transform: scale(1.2);\n        }\n\n        .colorchooser {\n          width: 30px;\n          height: 30px;\n          margin: 5px;\n        }\n\n        .colorchooser:last-child {\n          padding-bottom: 10px\n        }\n\n        .colorchooser > div {\n          width: 100%;\n          height: 100%;\n          border-radius: 100%;\n          border: 1px solid #afafaf;\n          box-sizing: border-box;\n        }\n\n        .colorchooser[selected] > div {\n          border-radius: 0;\n        }\n\n        .colorchooser.animated > div {\n          transform: scale(1);\n          will-change: transform, border-radius;\n          transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.75s, box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n\n        .colorchooser.animated:hover > div {\n          transform: scale(1.1);\n        }\n        \n        .paint {\n          display: flex;\n          width: 100%;\n          height: 100%;\n          background-color: #afafaf;\n        }\n\n        .toolbar {\n          min-width: 40px;\n          max-width: 40px;\n          width: 40px;\n          overflow: hidden;\n          background-color: white;\n        }\n\n        .toolbar > .colors {\n          height: calc(100% - 50px);\n          margin-right: calc((100% + 15px) * -1);\n          padding-right: 40px;\n          overflow-y: scroll;\n        }\n\n        #paintingarea {\n          width: 100%;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          margin: 1vmax;\n        }\n\n        #canvas {\n          background-color: white;\n          touch-action: none;\n        }\n      </style>\n      <div class=\"paint\">\n        <div class=\"toolbar\">\n          <div class=\"icon animated\" on-click=\"","\">\n            ","\n          </div>\n          <div class=\"colors\">\n          ","\n          </div>\n        </div>\n        <div id=\"paintingarea\">\n          <canvas id=\"canvas\" class=\"shadow\" width=\"","\" height=\"","\"\n            onpointerdown=\"","\"\n            onpointermove=\"","\"\n            onpointerup=\"","\"\n            onpointercancel=\"","\"\n          ></canvas>\n        </div>\n      </div>\n    "]),_templateObject2_d4a2d29070a711e8ad63dbb32815d43a=babelHelpers.taggedTemplateLiteral(["\n            <div class=\"colorchooser animated\" on-click=\"","\" selected?=\"","\">\n              <div style=\"background-color: ",";\" class=\"shadow elevate\"></div>\n            </div>\n          "]),htmlcolors={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"};_exports.htmlcolors=htmlcolors;var htmlcolors_hsl=function generate_htmlcolors_hsl(){var colors=["hsl(0, 0%, 0%)","hsl(0, 0%, 50%)","hsl(0, 0%, 100%)"],h=340;while(0<=h){colors.push("hsl("+h+", 100%, 50%)");h-=20}return colors}();_exports.htmlcolors_hsl=htmlcolors_hsl;_exports.$htmlcolors={htmlcolors:htmlcolors,htmlcolors_hsl:htmlcolors_hsl};function waitTillTrue(fn){for(var _this=this,_len=arguments.length,args=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}return new Promise(function(resolve){var intervalId=setInterval(function(){var retVal=fn.apply(_this,args);if(retVal){clearInterval(intervalId);resolve(retVal)}},50)})}_exports.$promises={waitTillTrue:waitTillTrue};function waitForId(root,id){return waitTillTrue(function(r,i){return r.getElementById(i)},root,id)}_exports.$elements={waitForId:waitForId};var PaintPage=function(_connect){babelHelpers.inherits(PaintPage,_connect);function PaintPage(){babelHelpers.classCallCheck(this,PaintPage);return babelHelpers.possibleConstructorReturn(this,(PaintPage.__proto__||Object.getPrototypeOf(PaintPage)).apply(this,arguments))}babelHelpers.createClass(PaintPage,[{key:"_render",value:function _render(_ref){var _this2=this,_painting=_ref._painting,_color=_ref._color,_canvasWidth=_ref._canvasWidth,_canvasHeight=_ref._canvasHeight;console.log("render: "+this._canvasWidth+":"+this._canvasHeight);return(0,_myApp.html)(_templateObject_d4a2d29070a711e8ad63dbb32815d43a,_myApp.AnimatedStyles,_myApp.ShadowStyles,function(){return _this2._goToOverview()},_myApp.arrowBack,(0,_myApp.repeat)(htmlcolors_hsl,function(item){return(0,_myApp.html)(_templateObject2_d4a2d29070a711e8ad63dbb32815d43a,function(){return _this2._setColor(item)},item===_color,item)}),_canvasWidth,_canvasHeight,function(e){return _this2._pointerDown(e)},function(e){return _this2._pointerMove(e)},function(e){return _this2._pointerUp(e)},function(e){return _this2._pointerCancel(e)})}},{key:"_firstRendered",value:function _firstRendered(){var _this3=this;babelHelpers.get(PaintPage.prototype.__proto__||Object.getPrototypeOf(PaintPage.prototype),"_firstRendered",this).call(this);waitForId(this.shadowRoot,"canvas").then(function(canvas){_this3._canvas=canvas;_this3._context=_this3._canvas.getContext("2d");_this3._setCanvasGeometry(_this3._canvas);window.addEventListener("orientationchange",function(e){console.log("orientaitonchange");_this3._setCanvasGeometry(_this3._canvas,e)})})}},{key:"_didRender",value:function _didRender(props,changedProps,prevProps){var _this4=this;if(changedProps._painting){waitForId(this.shadowRoot,"canvas").then(function(canvas){_this4._canvas=canvas;_this4._context=_this4._canvas.getContext("2d");_this4._context.clearRect(0,0,_this4._canvasWidth,_this4._canvasHeight);_this4._painting.draw(_this4._canvas);_this4._color="hsl(0, 0%, 0%)"})}babelHelpers.get(PaintPage.prototype.__proto__||Object.getPrototypeOf(PaintPage.prototype),"_didRender",this).call(this,props,changedProps,prevProps)}},{key:"_stateChanged",value:function _stateChanged(state){this._painting=(0,_myApp.paintingSelector)(state)}},{key:"_shouldPropertyChange",value:function _shouldPropertyChange(property,value,old){if("_canvasWidth"===property||"_canvasHeight"===property){console.log(property+" "+old+" -> "+value);return!0}return babelHelpers.get(PaintPage.prototype.__proto__||Object.getPrototypeOf(PaintPage.prototype),"_shouldPropertyChange",this).call(this,property,value,old)}},{key:"_setCanvasGeometry",value:function(){var _setCanvasGeometry2=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function _callee(canvas,event){var paintingarea,areaWidth,areaHeight,scale,_areaWidth,_areaHeight,_scale;return regeneratorRuntime.wrap(function(_context){var _Mathmin=Math.min;while(1){switch(_context.prev=_context.next){case 0:console.log(event);paintingarea=this.shadowRoot.getElementById("paintingarea");console.log("_setCanvasGeometry start "+this._canvasWidth+":"+this._canvasHeight);if(!(0,_myApp.isLandscape)()){_context.next=14;break}_context.next=6;return waitTillTrue(function(){return(0,_myApp.isLandscape)(paintingarea.clientWidth,paintingarea.clientHeight)});case 6:console.log("landscape");areaWidth=paintingarea.clientWidth;areaHeight=paintingarea.clientHeight;scale=_Mathmin(areaWidth/297,areaHeight/210);this._canvasHeight=210*scale;this._canvasWidth=297*scale;_context.next=22;break;case 14:_context.next=16;return waitTillTrue(function(){return!(0,_myApp.isLandscape)(paintingarea.clientWidth,paintingarea.clientHeight)});case 16:console.log("portrait");_areaWidth=paintingarea.clientWidth;_areaHeight=paintingarea.clientHeight;_scale=_Mathmin(_areaWidth/210,_areaHeight/297);this._canvasHeight=297*_scale;this._canvasWidth=210*_scale;case 22:console.log("_setCanvasGeometry end "+this._canvasWidth+":"+this._canvasHeight);case 23:case"end":return _context.stop();}}},_callee,this)}));return function _setCanvasGeometry(){return _setCanvasGeometry2.apply(this,arguments)}}()},{key:"_goToOverview",value:function _goToOverview(){this._context.clearRect(0,0,this._canvasWidth,this._canvasHeight);this._painting=void 0;_myApp.store.dispatch((0,_myApp.updateLocationURL)("/"))}},{key:"_setColor",value:function _setColor(color){this._color=color}},{key:"_pointerDown",value:function _pointerDown(event){event.preventDefault();this._paint=!0;var point=this._extractPoint(event);this._currentStroke=new _myApp.Stroke(this._color);this._currentStroke.addPoint(point);this._context.strokeStyle=this._color;this._context.lineWidth=4;this._context.beginPath();this._context.moveTo(point.x,point.y)}},{key:"_pointerMove",value:function _pointerMove(event){if(this._paint){event.preventDefault();var point=this._extractPoint(event);this._currentStroke.addPoint(point);this._context.lineTo(point.x,point.y);this._context.stroke()}}},{key:"_pointerUp",value:function _pointerUp(event){var _this5=this;event.preventDefault();this._paint=!1;this._painting.addStroke(this._currentStroke);setTimeout(function(){_this5._painting.dataURL=_this5._canvas.toDataURL("image/png");_myApp.store.dispatch((0,_painting2.trigger)())})}},{key:"_pointerCancel",value:function _pointerCancel(event){this._pointerUp(event)}},{key:"_extractPoint",value:function _extractPoint(event){return{x:event.pageX-this._canvas.offsetLeft,y:event.pageY-this._canvas.offsetTop}}}],[{key:"properties",get:function get(){return{_painting:Object,_color:String,_canvasWidth:Number,_canvasHeight:Number}}}]);return PaintPage}((0,_myApp.connect)(_myApp.store)(_myApp.PageViewElement));window.customElements.define("paint-page",PaintPage)});